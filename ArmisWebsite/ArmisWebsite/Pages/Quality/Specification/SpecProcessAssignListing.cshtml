@page
@model ArmisWebsite.Pages.Quality.Specification.SpecProcessAssignListingModel
@{
    ViewData["Title"] = "SpecProcessAssignListing";
}
<div class="container-fluid w-75">
    <h1>Specification-Process Assignment Listing</h1>

    <div class="input-group my-1">
        @*Search by... Filter needs to be added.*@
        <input id="inputStepSearchFilter" type="text" class="form-control border-right-0" placeholder="Search By Specificaiton Code..." onkeyup="searchSpecProcessAssignList(this.value)" />
        <span class="input-group-append bg-white border-left-0">
            <span class="input-group-text bg-transparent"><i class="fa fa-search"></i></span>
        </span>
    </div>

    <ul id="allAssignsList" class="list-group" style="height:42em; overflow-y:scroll">
        @{
            var allSpecIds = new List<int>();

            foreach (var specProcessAssign in Model.AllSpecProcessAssigns)
            {
                if (!allSpecIds.Contains(specProcessAssign.SpecId))
                { allSpecIds.Add(specProcessAssign.SpecId); }
            }
        }

        @foreach (var specId in allSpecIds)
        {
            var allSpasForSpecId = Model.AllSpecProcessAssigns.Where(i => i.SpecId == specId);
            var spec = allSpasForSpecId.FirstOrDefault().SpecificationRevision; //This is used in order to get the specification information for the "header" section.

            <li class="list-group-item" data-spec="@spec.SpecCode">
                <a data-toggle="collapse" href="#specGroup_@spec.SpecId">
                    @spec.SpecId.
                    Specification: <b>@spec.SpecCode</b>
                    Rev: <b>@spec.ExternalRev</b>
                </a>

                @foreach (var specProcessAssign in allSpasForSpecId)
                {


                    <div id="specGroup_@specProcessAssign.SpecId" class="collapse">
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <a data-toggle="collapse" href="#specProcAssign_@specProcessAssign.SpecId-@specProcessAssign.SpecRevId-@specProcessAssign.SpecAssignId">
                            @specProcessAssign.SpecAssignId.
                            Process: <b>@specProcessAssign.ProcessRevision.ProcessId. @specProcessAssign.ProcessRevision.ProcessName</b>
                            Rev: <b>@specProcessAssign.ProcessRevId</b>
                        </a>

                        <div id="specProcAssign_@specProcessAssign.SpecId-@specProcessAssign.SpecRevId-@specProcessAssign.SpecAssignId" class="row collapse">
                            Customer: &nbsp;
                            @if (specProcessAssign.Customer != null)
                            {<b>@specProcessAssign.Customer.Name</b>}
                        else
                        { <text>NONE</text>}

                            @if (specProcessAssign.SpecificationRevision.SpecCode == "TestLargeSpec") { var testBreak = "Here!"; }
                            <table class="table table-bordered table-striped table-hover">
                                <tr>
                                    <th class="text-center" style="border-bottom-color:black">Sublevel 1</th>
                                    <th class="text-center" style="border-bottom-color:black">Sublevel 2</th>
                                    <th class="text-center" style="border-bottom-color:black">Sublevel 3</th>
                                    <th class="text-center" style="border-bottom-color:black">Sublevel 4</th>
                                </tr>

                                <tr>
                                    <td class="text-center">
                                        @if (specProcessAssign.Choice1 != null && specProcessAssign.Choice1.Name != null)
                                        {@specProcessAssign.Choice1.Name}
                                    </td>

                                    <td class="text-center">
                                        @if (specProcessAssign.Choice2 != null && specProcessAssign.Choice2.Name != null)
                                        {@specProcessAssign.Choice2.Name}
                                    </td>

                                    <td class="text-center">
                                        @if (specProcessAssign.Choice3 != null && specProcessAssign.Choice3.Name != null)
                                        {@specProcessAssign.Choice3.Name}
                                    </td>

                                    <td class="text-center">
                                        @if (specProcessAssign.Choice4 != null && specProcessAssign.Choice4.Name != null)
                                        {@specProcessAssign.Choice4.Name}
                                    </td>
                                </tr>
                            </table>

                            <table class="table table-bordered table-striped table-hover">
                                <tr>
                                    <th class="text-center" style="border-bottom-color:black; width:16.6%;">Pre-Bake</th>
                                    <th class="text-center" style="border-bottom-color:black; width:16.6%;">Post-Bake</th>
                                    <th class="text-center" style="border-bottom-color:black; width:16.6%;">Mask</th>
                                    <th class="text-center" style="border-bottom-color:black; width:16.6%;">Hardness</th>
                                    <th class="text-center" style="border-bottom-color:black; width:16.6%;">Series</th>
                                    <th class="text-center" style="border-bottom-color:black; width:16.6%;">Alloy</th>
                                </tr>

                                <tr>
                                    <td class="text-center">
                                        @if (specProcessAssign.PreBakeOption != null && specProcessAssign.PreBakeOption.StepName != null)
                                        {@specProcessAssign.PreBakeOption.StepName}
                                    </td>

                                    <td class="text-center">
                                        @if (specProcessAssign.PostBakeOption != null && specProcessAssign.PostBakeOption.StepName != null)
                                        {@specProcessAssign.PostBakeOption.StepName}
                                    </td>

                                    <td class="text-center">
                                        @if (specProcessAssign.MaskOption != null && specProcessAssign.MaskOption.StepName != null)
                                        {@specProcessAssign.MaskOption.StepName}
                                    </td>

                                    <td class="text-center">
                                        @if (specProcessAssign.HardnessOption != null && specProcessAssign.HardnessOption.ShortName != null)
                                        {@specProcessAssign.HardnessOption.ShortName}
                                    </td>

                                    <td class="text-center">
                                        @if (specProcessAssign.SeriesOption != null && specProcessAssign.SeriesOption.ShortName != null)
                                        {@specProcessAssign.SeriesOption.ShortName}
                                    </td>


                                    <td class="text-center">
                                        @if (specProcessAssign.AlloyOption != null && specProcessAssign.AlloyOption.Description != null)
                                        {@specProcessAssign.AlloyOption.Description}
                                    </td>
                                </tr>
                            </table>

                            @*@if (specProcessAssign.Choice1 != null && specProcessAssign.Choice1.Name != null)
                                {
                                    <p>@specProcessAssign.Choice1.Name</p>
                                }
                                @if (specProcessAssign.Choice2 != null && specProcessAssign.Choice2.Name != null)
                                {
                                    <p>@specProcessAssign.Choice2.Name</p>
                                }
                                @if (specProcessAssign.Choice3 != null && specProcessAssign.Choice3.Name != null)
                                {
                                    <p>@specProcessAssign.Choice3.Name</p>
                                }
                                @if (specProcessAssign.Choice4 != null && specProcessAssign.Choice4.Name != null)
                                {
                                    <p>@specProcessAssign.Choice4.Name</p>
                                }
                                @if (specProcessAssign.Choice5 != null && specProcessAssign.Choice5.Name != null)
                                {
                                    <p>@specProcessAssign.Choice5.Name</p>
                                }
                                @if (specProcessAssign.Choice6 != null && specProcessAssign.Choice6.Name != null)
                                {
                                    <p>@specProcessAssign.Choice6.Name</p>
                                }*@
                            @*</div>*@

                            @*<div class="card col-lg-3">
                                    <b>Details</b>
                                    @if (specProcessAssign.Customer != null)
                                    {<p>Customer: @specProcessAssign.Customer.Name</p>}
                                    @if (specProcessAssign.SeriesOption != null)
                                    {<p>Series: @specProcessAssign.SeriesOption.Description [@specProcessAssign.SeriesOption.ShortName] </p>}
                                    <p>Hardness: @specProcessAssign.HardnessOptionId</p>

                                    <p>Alloy: @specProcessAssign.AlloyOptionId</p>
                                </div>*@
                        </div>
                    </div>
                }
            </li>
        }
    </ul>
</div>

<script>
    function searchSpecProcessAssignList(searchTerm) {
        var assigns = document.getElementById("allAssignsList").getElementsByTagName("li");
        for (var i = 0; i < assigns.length; i++) {
            if (assigns[i] != undefined) {
                if (assigns[i].dataset.spec.toLowerCase().includes(searchTerm.toLowerCase())) {
                    console.log(assigns[i].dataset.spec.toLowerCase() + " : " + searchTerm);
                    assigns[i].style.display = "block";
                }
                else {
                    assigns[i].style.display = "none";
                }
            }
        }
    }
</script>